
<div class="row anu-container">
    <div class="col-12 bg-white" style="position:sticky;top:80px;z-index:1040;">
        <div class="row">
            <h4 class="col-11 text-left my-3 section-header">Disbursement Request</h4>
            <div class="col-1 text-right" style="display: flex;align-items: center;justify-content: flex-start;">
                <!--mat-icon mat-button [matMenuTriggerFor]="menu" class="float-right" style="cursor:pointer;">more_vert
                </mat-icon-->
                <!--mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="showHistory('disbursement',currentDisbursement)"><mat-icon class="ml-1">comment</mat-icon>Notes</button>
                    <button mat-menu-item (click)="showWorkflowAssigments()"><mat-icon class="ml-1">assignment</mat-icon>Assignments</button>
                    <ng-container>
                        <hr>
                        <button mat-menu-item (click)="manageGrant()"><img class="ml-2 mr-3" style="width:20px;height:20px;" src="./assets/img/dp.svg">View Grant</button>
                        <button mat-menu-item (click)="manageReport()"><img class="ml-2 mr-3" style="width:20px;height:20px;" src="./assets/img/dp.svg">View Approved Reports</button>
                    </ng-container>
                </mat-menu-->
            </div>
        </div>
    </div>
    <div class="col-lg-12">
        <div #container class="container text-left mt-2 px-0 py-2">
            <div class="row w-100 p-0 mt-3 mb-2 mx-0 grants-section">
                <div class="col-12">
                    <div class="row p-2" style="background:#fafafa;">
                        <div class="col-12 mb-1">
                            <mat-label>Grant Name:</mat-label>
                            <div class="ml-0 mb-1"><b>{{(currentDisbursement.grant.referenceNo?currentDisbursement.grant.referenceNo+' | ':'') + currentDisbursement.grant.name}}</b></div>
                        </div>
                    
                        <div class="col-8 mb-1">
                            <mat-label>Duration:</mat-label>
                            <div class="row ml-0 mb-3">
                                <div>
                                    <mat-icon [inline]="true" class="mr-1">calendar_today
                                    </mat-icon>
                                    <b>{{currentDisbursement.grant.startDate | date:'dd-MMM-yyyy'}}</b></div>
                                <div>
                                    <mat-icon [inline]="true" class="mx-3 my-0">arrow_forward
                                    </mat-icon>
                                </div>
                                <div>
                                    <mat-icon [inline]="true" class="mr-1">calendar_today
                                    </mat-icon>
                                    <b>{{currentDisbursement.grant.endDate | date:'dd-MMM-yyyy'}}</b></div>
                            </div>
                        </div>
                        <div class="col-4">
                            <mat-label>Grantee Organization:</mat-label>
                            <div class="ml-0 mb-1"><b>{{currentDisbursement.grant.organization?currentDisbursement.grant.organization.name:''}}</b></div>
                        </div>
                        <div class="col-12">
                            <mat-label>Grant Amount:</mat-label>
                            <div class="ml-0 mb-1"><b>{{currencyService.getFormattedAmount(currentDisbursement.grant.amount)}}</b>
                                &nbsp;&nbsp;&nbsp;<small>{{currencyService.getAmountInWords(currentDisbursement.grant.amount)}}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12" *ngIf="getGrantDisbursementAttribute()">
                    <table id="tablePlaceholderX" width="100%">
                      <tr style="background: #f9f9f9">
                        <td width="2%" align="center" valign="middle" style="border: 1px solid #e4e4e4;">
                          Planned Installment #
                        </td>
                        <ng-container *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns, let i = index">
                          <td *ngIf="column.name!=='Notes'" width="15%" align="center" valign="middle" style="border: 1px solid #e4e4e4;" >
                            {{column.name}}
                          </td>
                          <td *ngIf="column.name==='Notes'" width="50%" align="center" valign="middle" style="border: 1px solid #e4e4e4;" >
                            {{column.name}}
                          </td>
                        </ng-container>
                      </tr>
                      <ng-container *ngFor="let row of getGrantDisbursementAttribute().fieldTableValue, let i = index">
                        <tr>
                          <td width="2%" class="anu-input m-0 text-center" style="background:#f4f4f4 !important;">
                           {{row.name}}
                          </td>
                          <ng-container *ngFor="let column of row.columns,let j = index">
                            <td width="15%" *ngIf="!column.dataType && column.name!=='Notes'" class="anu-input m-0" style="background:#f4f4f4 !important;">
                                {{column.value}}
                            </td>
                            <td width="50%"  *ngIf="!column.dataType && column.name==='Notes'" width="60%" class="anu-input m-0" style="background:#f4f4f4 !important;">
                                {{column.value}}
                            </td>
                            <td  *ngIf="column.dataType==='currency'" align="right" class="anu-input text-right m-0" style="background:#f4f4f4 !important;">
                                â‚¹ {{currencyService.getFormattedAmount(column.value)}}
                            </td>
                          </ng-container>
                        </tr>
                      </ng-container>
                      <tr *ngIf="getGrantDisbursementAttribute().fieldTableValue.length>1" style="background:#f4f4f4;">
                        <td class="py-2" colspan="2" align="center" style="position: sticky; left: 0; z-index: 1;font-weight:600;">GRANT TOTALS:</td>
                        <ng-container *ngFor="let column of getGrantDisbursementAttribute().fieldTableValue[0].columns,let j = index" valign="middle">
                          <td class="text-right pr-3 my-0" *ngIf="column.dataType==='currency'"><b>{{getTotals(j,getGrantDisbursementAttribute().fieldTableValue)}}</b></td>
                        </ng-container>
                        <td>&nbsp;</td>
                      </tr>
                    </table>
                </div>
                <div class="col-12">
                    <div class="row mt-4">
                        <div class="col-4">
                            <mat-form-field>
                                <input #disbursementAmount  (blur)="showFormattedAmount($event)" matInput class="anu-input" placeholder="Requested Amount:" [(ngModel)]='currentDisbursement.requestedAmount' type="number"/>
                                <p #disbursementAmountFormatted (click)="showAmountInput($event)" class="anu-input w-100" style="position:absolute;top:7px;cursor: text;" [innerHtml]="currencyService.getFormattedAmount(currentDisbursement.requestedAmount)"></p>
                            </mat-form-field>
                            

                        </div>
                        <div class="col-8">
                            <label style="font-weight: 400; font-family: Lato; color: rgba(0,0,0,.54);">Requested Amount (In Words)</label>
                            <p  disabled readonly [innerHtml]="currencyService.getAmountInWords(currentDisbursement.requestedAmount)"></p>
                        </div>
                        <div class="col-12">
                            <mat-form-field>
                                <input matInput class="anu-input" placeholder="Note:" [(ngModel)]='currentDisbursement.reason'/>
                            </mat-form-field>
                        </div>
                    </div>
                   
                </div>
            </div>
        </div>
    </div>
</div>

