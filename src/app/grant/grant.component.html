<mat-sidenav-container class="example-container">
    <mat-sidenav #sidenav fixedInViewport="false" fixedTopGap="80" disableClose="true" position="end"
                 mode="push" [(opened)]="attachmentsSideNavOpened" style="top: 80px !important;">

        <h3>Attachments</h3>
        <button mat-button color="accent" (click)="closeAttachmentsSideNav()">Close
        </button>

    </mat-sidenav>
    <mat-sidenav-content>
        <div class="container text-left mt-5 px-5 py-5" (scroll)="rememberScrollPosition($event)">
            <div class="fixed-bottom"
                 style="right: 20px; left: auto;z-index: 4;display: flex;align-items: flex-end;flex-direction: column;justify-content: right;">
                <button #saveGrantButton (click)="saveGrant()" *ngIf="editMode" class="btn btn-sm btn-info">
                    <i class="fa fa-save mr-2"></i>Save Changes
                </button>

                <button *ngIf="currentGrant.actionAuthorities.permissions.includes('MANAGE') && currentGrant.submissions.length>0"
                        #addKpiButton
                        (click)="addNewKpi()" class="btn btn-sm btn-danger">
                    <i class="fa fa-save mr-2"></i>Add KPI
                </button>
                <div #actionBlock>
                    <ng-container *ngIf="currentGrant.flowAuthorities">
                        <div *ngFor="let flow of currentGrant.flowAuthorities">
                            <div class="btn btn-sm btn-success" (click)="submitGrant(flow.toStateId)"
                                 id="{{flow.action}}">{{flow.action}}</div>
                        </div>
                    </ng-container>
                    <ng-container *ngIf="currentSubmission">
                        <div *ngFor="let flow of currentSubmission.flowAuthorities">
                            <div name="flowActionBtn" [ngClass]="['btn', 'btn-sm']"
                                 (click)="saveSubmissionAndMove(flow.toStateId)"
                                 id="{{flow.action}}">{{flow.action}}</div>
                        </div>
                    </ng-container>
                </div>

            </div>

            <a class="btn btn-sm btn-outline-secondary" (click)="appComp.goToHome()"><i
                    class="fa fa-home mr-2"></i>Home</a>
            <span
                    class="badge badge-dark text-white pull-right">{{currentGrant.substatus.displayName}}</span>
            <span class="badge badge-success pull-right">{{currentGrant.grantStatus.displayName}}</span>
            <div *ngIf="!canManage">
                <div class="row">
                    <div class="col-6">
                        <mat-form-field>
                            <input matInput readonly placeholder="Grant Name"
                                   [ngModel]="currentGrant.name" [ngModelOptions]="{standAlone:true}">
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input matInput readonly placeholder="Grant Description"
                                   [ngModel]="currentGrant.description" [ngModelOptions]="{standAlone:true}">
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input matInput readonly [ngModel]="currentGrant.startDate | date:'dd-MMM-yyyy'"
                                   placeholder="Grant Start Date">
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input matInput readonly [ngModel]="currentGrant.endDate | date:'dd-MMM-yyyy'"
                                   placeholder="Grant End Date">
                        </mat-form-field>
                    </div>

                    <ng-container *ngFor="let section of currentGrant.grantDetails.sections">
                        <mat-accordion class="col-sm-12 col-lg-6">
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        {{section.sectionName.toLocaleUpperCase()}}
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <ng-container *ngFor="let attribute of section.attributes">
                                    <mat-form-field *ngIf="attribute.fieldType==='string'">
                                        <input matInput readonly placeholder="{{attribute.fieldName}}"
                                               [ngModel]="attribute.fieldValue">
                                    </mat-form-field>
                                    <mat-nav-list>
                                        <ng-container *ngIf="attribute.fieldType==='document'">
                                            <mat-list-item>
                                                <mat-icon mat-list-icon>attachment</mat-icon>
                                                <a mat-tab-link mat-line target="_blank"
                                                   [href]="'/api/public/grants/'+currentGrant.id+'/file/'+attribute.fieldName">
                                                    {{attribute.fieldName}}
                                                </a>
                                            </mat-list-item>
                                        </ng-container>
                                    </mat-nav-list>
                                </ng-container>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </ng-container>
                </div>
                <hr>

                <div class="row flex-row flex-nowrap" style="overflow-x: auto"
                     (scroll)="postionFirstColumn($event)">
                    <ng-container
                            *ngFor="let dummy of ' '.repeat(currentGrant.submissions.length + 1 ).split(''), let x = index">


                        <ng-container *ngIf="x!==0">
                            <div class="col-3 p-0" [style.border-top]="'0.5px solid #d4d4d4'"
                                 [style.border-right]="'0.5px solid #d4d4d4'"
                                 [style.box-shadow]="currentGrant.submissions[x-1].flowAuthorities?'box-shadow:1px 1px 12px #d4d4d4':''">
                                <div
                                        [ngClass]="['col-12','py-2', 'mb-4','text-center', currentGrant.submissions[x - 1].flowAuthorities? 'bg-primary text-white' : 'bg-light']">{{currentGrant.submissions[x
                                - 1].title}}
                                </div>
                                <ng-container
                                        *ngFor="let kpiData of currentGrant.submissions[x - 1].quantitiaveKpisubmissions">
                                    <div class="py-3" [attr.data-id]="kpiData.grantKpi.id"
                                         style="display: flex;align-items: center;justify-content: center; border-bottom: .5px solid #d4d4d4;">
                                        <ng-container *ngIf="kpiData.toReport">
                                            <ng-container *ngIf="currentGrant.submissions[x -1].flowAuthorities">
                                                <mat-form-field>
                                                    <input matInput [(ngModel)]="kpiData.actuals"
                                                           placeholder="{{kpiData.goal}}"
                                                           [ngModelOptions]="{standAlone:true}"
                                                           (ngModelChange)="checkGrant()" type="number">
                                                </mat-form-field>
                                            </ng-container>
                                            <ng-container *ngIf="!currentGrant.submissions[x -1].flowAuthorities">
                                                {{kpiData.actuals}} / {{kpiData.goal}}
                                            </ng-container>
                                            <div style="position: absolute;right: 40px;">
                                                <mat-icon inline="true"
                                                          (click)="openBottomSheetForSubmittionAttachments(kpiData.id,kpiData.grantKpi.kpiType,kpiData.grantKpi.title,kpiData.submissionDocs,currentGrant.submissions[x -1].flowAuthorities)"
                                                          [color]="kpiData.submissionDocs.length>0?'accent':'text-gray'">
                                                    attachment
                                                </mat-icon>
                                            </div>
                                            <div style="position: absolute;right: 10px;">
                                                <mat-icon inline="true"
                                                          (click)="openBottomSheetForSubmittionNotes(kpiData.id,kpiData.grantKpi.kpiType,kpiData.grantKpi.title,kpiData.notesHistory,currentGrant.submissions[x -1].flowAuthorities)"
                                                          [color]="kpiData.notesHistory && kpiData.notesHistory.length>0?'accent':'text-gray'">
                                                    chat
                                                </mat-icon>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="!kpiData.toReport">
                                            Submission not required
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <ng-container
                                        *ngFor="let kpiData of currentGrant.submissions[x - 1].qualitativeKpiSubmissions">
                                    <div class="py-3" [attr.data-id]="kpiData.grantKpi.id"
                                         style="display: flex;align-items: center;justify-content: center; border-bottom: .5px solid #d4d4d4;">
                                        <ng-container *ngIf="kpiData.toReport">
                                            <ng-container *ngIf="currentGrant.submissions[x -1].flowAuthorities">
                                                <mat-form-field>
                  <textarea matInput
                            [(ngModel)]="kpiData.actuals" [ngModelOptions]="{standAlone:true}"
                            (ngModelChange)="checkGrant()" placeholder="Your response"
                  ></textarea>
                                                </mat-form-field>
                                            </ng-container>
                                            <ng-container *ngIf="!currentGrant.submissions[x -1].flowAuthorities">
                                                <p>{{kpiData.actuals}}</p>
                                            </ng-container>
                                            <div style="position: absolute;right: 40px;">
                                                <mat-icon inline="true"
                                                          (click)="openBottomSheetForSubmittionAttachments(kpiData.id,kpiData.grantKpi.kpiType,kpiData.grantKpi.title,kpiData.submissionDocs,currentGrant.submissions[x -1].flowAuthorities)"
                                                          [color]="kpiData.submissionDocs.length>0?'accent':'text-gray'">
                                                    attachment
                                                </mat-icon>
                                            </div>
                                            <div style="position: absolute;right: 10px;">
                                                <mat-icon inline="true"
                                                          (click)="openBottomSheetForSubmittionNotes(kpiData.id,kpiData.grantKpi.kpiType,kpiData.grantKpi.title,kpiData.notesHistory,currentGrant.submissions[x -1].flowAuthorities)"
                                                          [color]="kpiData.notesHistory && kpiData.notesHistory.length>0?'accent':'text-gray'">
                                                    chat
                                                </mat-icon>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="!kpiData.toReport">
                                            Submission not required
                                        </ng-container>
                                    </div>
                                </ng-container>
                                <ng-container
                                        *ngFor="let kpiData of currentGrant.submissions[x - 1].documentKpiSubmissions">
                                    <div class="py-3" [attr.data-id]="kpiData.grantKpi.id"
                                         style="display: flex;align-items: center;justify-content: center; border-bottom: .5px solid #d4d4d4;">
                                        <ng-container *ngIf="kpiData.toReport">
                                            <ng-container *ngIf="currentGrant.submissions[x -1].flowAuthorities">
                                                <button mat-raised-button color="accent">Attachments</button>
                                            </ng-container>
                                            <ng-container *ngIf="!currentGrant.submissions[x -1].flowAuthorities">
                                                <button class="btn btn-sm btn-primary" disabled>Upload</button>
                                            </ng-container>
                                            <div style="position: absolute;right: 10px;">
                                                <mat-icon inline="true"
                                                          (click)="openBottomSheetForSubmittionNotes(kpiData.id,kpiData.grantKpi.kpiType,kpiData.grantKpi.title,kpiData.notesHistory,currentGrant.submissions[x -1].flowAuthorities)"
                                                          [color]="kpiData.notesHistory && kpiData.notesHistory.length>0?'accent':'text-gray'">
                                                    chat
                                                </mat-icon>
                                            </div>
                                        </ng-container>
                                        <ng-container *ngIf="!kpiData.toReport">
                                            Submission not required
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>

                        <ng-container *ngIf="x===0">
                            <div class="col-6 first-column bg-white"
                                 style="border: 0.5px solid #d4d4d4; z-index: 100;">
                                <div class="affix">
                                    <div class="row affix">
                                        <div class="col-12 mb-4 py-2">&nbsp;</div>
                                        <ng-container
                                                *ngFor="let kpiData of currentGrant.submissions[x].quantitiaveKpisubmissions">
                                            <div class="col-12 py-3" id="kpi_title_{{kpiData.grantKpi.id}}"
                                                 style="border-bottom: .5px solid #d4d4d4;">
                                                <p class="p-1">{{kpiData.grantKpi.title}}</p>
                                                <button mat-stroked-button class="my-2"
                                                        *ngIf="kpiData.grantKpi.templates.length > 0"
                                                        matBadge="{{kpiData.grantKpi.templates.length}}"
                                                        matBadgeOverlap="true" matBadgePosition="above after"
                                                        matBadgeColor="accent"
                                                        (click)="openBottomSheet(kpiData.grantKpi.id, kpiData.grantKpi.title, kpiData.grantKpi.templates, canManage)">
                                                    View templates
                                                </button>
                                            </div>
                                        </ng-container>

                                        <ng-container
                                                *ngFor="let kpiData of currentGrant.submissions[x].qualitativeKpiSubmissions">
                                            <div class="col-12 py-3" id="kpi_title_{{kpiData.grantKpi.id}}"
                                                 style="border-bottom: .5px solid #d4d4d4;">
                                                <p>{{kpiData.grantKpi.title}}</p>
                                                <button mat-stroked-button class="my-2"
                                                        *ngIf="kpiData.grantKpi.templates.length > 0"
                                                        matBadge="{{kpiData.grantKpi.templates.length}}"
                                                        matBadgeOverlap="true" matBadgePosition="above after"
                                                        matBadgeColor="accent"
                                                        (click)="openBottomSheet(kpiData.grantKpi.id, kpiData.grantKpi.title, kpiData.grantKpi.templates, canManage)">
                                                    View templates
                                                </button>
                                            </div>

                                        </ng-container>

                                        <ng-container
                                                *ngFor="let kpiData of currentGrant.submissions[x].documentKpiSubmissions">
                                            <div class="col-12 py-3" id="kpi_title_{{kpiData.grantKpi.id}}"
                                                 style="border-bottom: .5px solid #d4d4d4;">
                                                <p>{{kpiData.grantKpi.title}}</p>
                                                <button mat-stroked-button class="my-2"
                                                        *ngIf="kpiData.grantKpi.templates.length > 0"
                                                        matBadge="{{kpiData.grantKpi.templates.length}}"
                                                        matBadgeOverlap="true" matBadgePosition="above after"
                                                        matBadgeColor="accent"
                                                        (click)="openBottomSheet(kpiData.grantKpi.id, kpiData.grantKpi.title, kpiData.grantKpi.templates, canManage)">
                                                    View templates
                                                </button>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
            <!--MANAGEMENT SECTION-->
            <div *ngIf="canManage">

                <div class="row">
                    <div class="col-6">
                        <mat-form-field>
                            <input matInput id="grantName" [(ngModel)]="currentGrant.name"
                                   [ngModelOptions]="{standAlone:true}" (ngModelChange)="checkGrant($event)"
                                   placeholder="Grant Name"
                                   type="text" autocomplete="off">
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input id="grantDesc" matInput type="text" [(ngModel)]="currentGrant.description"
                                   [ngModelOptions]="{standAlone:true}" (ngModelChange)="checkGrant()"
                                   placeholder="Grant Description" autocomplete="off">
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input id="grantStart" matInput [(ngModel)]="currentGrant.stDate"
                                   [ngModelOptions]="{standAlone:true}" (ngModelChange)="checkGrant()"
                                   [matDatepicker]="pickerStart" placeholder="Grant Start Date" type="text">
                            <mat-datepicker-toggle matPrefix [for]="pickerStart"></mat-datepicker-toggle>
                            <mat-datepicker #pickerStart></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <input id="grantEnd" matInput [(ngModel)]="currentGrant.enDate"
                                   [ngModelOptions]="{standAlone:true}" (ngModelChange)="checkGrant()"
                                   [matDatepicker]="pickerEnd" placeholder="Grant End Date" readonly>
                            <mat-datepicker-toggle matPrefix [for]="pickerEnd"></mat-datepicker-toggle>
                            <mat-datepicker #pickerEnd></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-6">
                        <mat-form-field>
                            <mat-select placeholder="Grant Receiver" matInput [value]="currentGrant.organization.id"
                                        (selectionChange)="setNewOrg($event)">
                                <mat-option *ngFor="let org of appComp.appConfig.granteeOrgs" [value]="org.id"
                                            (select)="org.id===currentGrant.organization.id">{{org.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-6"></div>

                    <ng-container *ngFor="let section of currentGrant.grantDetails.sections">
                        <mat-accordion class="col-sm-12 col-lg-6">
                            <mat-expansion-panel>
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        {{section.sectionName.toLocaleUpperCase()}}
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <div class="row">
                                    <div class="col-12 bg-light text-right">
                                        <a class="mr-2 text-gray"
                                           (click)="confirm(section.id,0,[],'section','section')"><i
                                                class="fa fa-edit"></i></a>
                                        <a class="mr-2 text-gray"
                                           (click)="confirm(section.id,0,[],'section','section')"><i
                                                class="fa fa-trash"></i></a>
                                        <a (click)="addNewFieldToSection(section.id,section.sectionName)"
                                           class="mr-2 text-gray"><i class="fa fa-plus-square"></i></a>
                                    </div>
                                </div>
                                <div>
                                    <ng-container *ngFor="let attribute of section.attributes">
                                        <div class="row mb-2 mt-2">
                                            <ng-container *ngIf="attribute.fieldType=='string'" class="mb-2">
                                                <div class="col-sm-4 col-lg-4">
                                                    <mat-form-field>
                                                        <input [(ngModel)]="attribute.fieldName"
                                                               [ngModelOptions]="{standAlone:true}"
                                                               (ngModelChange)="checkGrant()"
                                                               matInput placeholder="Field Name">
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-sm-4 col-lg-4 text-left">
                                                    <mat-form-field>
                                                        <mat-label>Type</mat-label>
                                                        <mat-select [(ngModel)]="attribute.fieldType"
                                                                    [ngModelOptions]="{standAlone:true}"
                                                                    (ngModelChange)="checkGrant()">
                                                            <mat-option value="none" aria-selected="true">--Select type
                                                                of field--
                                                            </mat-option>
                                                            <mat-option value="string">Text</mat-option>
                                                            <mat-option value="document">Document</mat-option>
                                                        </mat-select>

                                                    </mat-form-field>
                                                </div>
                                                <div class="col-sm-3 col-lg-3 text-left">
                                                    <mat-form-field>
                                                        <input matInput [(ngModel)]="attribute.fieldValue"
                                                               [ngModelOptions]="{standAlone:true}"
                                                               (ngModelChange)="checkGrant()">
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-sm-1 col-lg-1"
                                                     style="display: flex;align-items: center;">
                                                    <mat-icon
                                                            (click)="confirm(section.id,attribute.id,[],'field','field')"
                                                            aria-hidden="false"
                                                            aria-label="Example home icon" inline="true">
                                                        delete_outline
                                                    </mat-icon>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="attribute.fieldType=='document'">
                                                <div class="col-sm-7 col-lg-7">
                                                    <a href="/api/app/grants/{{currentGrant.id}}/file/{{attribute.fieldName}}">
                                                        <b class="">{{attribute.fieldName}}</b>
                                                    </a>
                                                </div>
                                                <div class="col-sm-4 col-lg-4">
                                                    <mat-form-field>
                                                        <mat-label>Type</mat-label>
                                                        <mat-select [(ngModel)]="attribute.fieldType"
                                                                    [ngModelOptions]="{standAlone:true}"
                                                                    (ngModelChange)="checkGrant()">
                                                            <mat-option value="none" aria-selected="true">--Select type
                                                                of field--
                                                            </mat-option>
                                                            <mat-option value="string">Text</mat-option>
                                                            <mat-option value="document">Document</mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div class="col-sm-1 col-lg-1"
                                                     style="display: flex;align-items: center;">
                                                    <mat-icon (click)="deleteFieldEntry()" aria-hidden="false"
                                                              aria-label="Example home icon" inline="true">
                                                        delete_outline
                                                    </mat-icon>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </ng-container>
                                </div>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </ng-container>
                    <div class="col-sm-12">
                        <a mat-stroked-button color="accent" (click)="addNewSection()" class="text-secondary"><i
                                class="fa fa-plus-square mr-1"></i>Add
                            new Section</a>
                    </div>
                </div>
                <hr>

                <div class="row">
                    <div class="col-sm-12 col-lg-pull-12 text-right">
                        <mat-select placeholder="Actions" (selectionChange)="performAction($event)">
                            <mat-option value="1">Add Single Submission Period</mat-option>
                            <mat-option value="2">Add Quarterly Submissions</mat-option>
                            <mat-option value="3">Clear All Submissions</mat-option>
                        </mat-select>
                    </div>
                </div>

                <mat-divider></mat-divider>
                <div class="row pt-3 submissions-block"
                     style="background-color:#f9f9f9;position: sticky;top: 82px;overflow-x: auto;z-index: 3;"
                     (scroll)="scrollHeaderContent($event)">
                    <div class="col-sm-12 col-lg-5"
                         style="background-color:#f9f9f9; position: sticky;left: 0;z-index: 3; border-right: 0.5px solid #d4d4d4;">
                        KPIs
                    </div>
                    <div class="col-sm-12 col-lg-7" style="z-index: 2;">
                        <div class="container-fluid">
                            <div class="row flex-row flex-nowrap">
                                <ng-container *ngFor="let submission of currentGrant.submissions">
                                    <div class="col-sm-4 col-lg-6"
                                         style="background-color:#f9f9f9; border-right: 0.5px solid #d4d4d4;">
                                        <div class="row">
                                            <div class="col-sm-12 text-center">
                                                <mat-form-field *ngIf="submission.id>0" class="text-center">
                                                    <input matInput class="text-center" [(ngModel)]="submission.title"
                                                           [ngModelOptions]="{standAlone:true}"
                                                           (ngModelChange)="checkGrant()"
                                                           placeholder="Submission Title">
                                                </mat-form-field>
                                                <mat-form-field *ngIf="submission.id<0" matBadge="N"
                                                                matBadgePosition="above after" matBadgeColor="accent"
                                                                class="text-center">
                                                    <input matInput class="text-center" [(ngModel)]="submission.title"
                                                           [ngModelOptions]="{standAlone:true}"
                                                           (ngModelChange)="checkGrant()"
                                                           placeholder="Submission Title">
                                                </mat-form-field>
                                                <mat-form-field class="text-center">
                                                    <input matInput [matDatepicker]="pickerSubmitBy"
                                                           [ngModel]="submission.submitBy | date:'yyyy-MM-dd'"
                                                           [ngModelOptions]="{standAlone:true}"
                                                           (dateChange)="setSubmissionDate(submission, $event)"
                                                           placeholder="Submit by Date">
                                                    <mat-datepicker-toggle matPrefix
                                                                           [for]="pickerSubmitBy"></mat-datepicker-toggle>
                                                    <mat-datepicker #pickerSubmitBy></mat-datepicker>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>
                <ng-container *ngIf="currentGrant.kpis.length==0">No KPIs set for this grant</ng-container>
                <ng-container *ngFor="let kpi of currentGrant.kpis">
                    <div class="row border-bottom kpi-block" style="overflow-x: auto;"
                         (scroll)="scrollChildContent($event)">
                        <div class="col-sm-12 col-lg-5 pt-2 bg-white"
                             style="z-index: 1;position:sticky;left: 0;border-right: 0.5px solid #d4d4d4;border-left: 4px solid #d4d4d4;">
                            <mat-icon color="accent" inline *ngIf="kpi.kpiReportingType==='ACTIVITY'">local_activity</mat-icon>
                            <mat-icon color="primary" inline *ngIf="kpi.kpiReportingType==='FINANCIAL'">attach_money</mat-icon>
                            <input matInput [(ngModel)]="kpi.title" ngModelOptions="{standAlone:true}"
                                   (ngModelChange)="checkGrant()">
                            <button mat-stroked-button class="my-2" *ngIf="kpi.templates.length === 0"
                                    (click)="openBottomSheet(kpi.id, kpi.title, kpi.templates,true)">
                                Attach template
                            </button>
                            <button mat-stroked-button class="my-2" *ngIf="kpi.templates.length > 0"
                                    matBadge="{{kpi.templates.length}}"
                                    matBadgeOverlap="true" matBadgePosition="above after" matBadgeColor="accent"
                                    (click)="openBottomSheet(kpi.id, kpi.title, kpi.templates,true)">
                                Attach template
                            </button>
                        </div>
                        <div class="col-sm-12 col-lg-7">
                            <div class="container-fluid" style="height: 100%;">
                                <div class="row flex-row flex-nowrap" style="height: 100%;">
                                    <ng-container *ngFor="let submission of currentGrant.submissions">
                                        <ng-container *ngIf="kpi.kpiType === 'QUANTITATIVE'">
                                            <ng-container *ngFor="let kpiData of submission.quantitiaveKpisubmissions">
                                                <ng-container *ngIf="kpi.id === kpiData.grantKpi.id">

                                                    <div class="col-sm-4 col-lg-6"
                                                         style="height: 100%;border-right: 0.5px solid #d4d4d4;">
                                                        <div class="row h-100">
                                                            <div class="col-sm-3"
                                                                 style="display: flex;align-items: center;">
                                                                <mat-checkbox color="primary"
                                                                              [(ngModel)]="kpiData.toReport"
                                                                              [ngModelOptions]="{standAlone:true}"
                                                                              (ngModelChange)="checkGrant()"></mat-checkbox>
                                                            </div>
                                                            <div class="col-sm-9" style="display:flex;align-items:center">
                                                                <mat-form-field>
                                                                    <input matInput type="number"
                                                                           [(ngModel)]="kpiData.goal"
                                                                           [ngModelOptions]="{standAlone:true}"
                                                                           (ngModelChange)="checkGrant()"
                                                                           placeholder="Goal">
                                                                </mat-form-field>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container *ngIf="kpi.kpiType === 'QUALITATIVE'">
                                            <ng-container *ngFor="let kpiData of submission.qualitativeKpiSubmissions">
                                                <ng-container *ngIf="kpi.id === kpiData.grantKpi.id">
                                                    <div class="col-sm-4 col-lg-6"
                                                         style="border-right: 0.5px solid #d4d4d4;">
                                                        <div class="row">
                                                            <div class="col-sm-6"
                                                                 style="display: flex;align-items: center;">
                                                                <mat-checkbox color="primary"
                                                                              [(ngModel)]="kpiData.toReport"
                                                                              [ngModelOptions]="{standAlone:true}"
                                                                              (ngModelChange)="checkGrant()"></mat-checkbox>

                                                            </div>
                                                            <div class="col-sm-6">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                        <ng-container *ngIf="kpi.kpiType === 'DOCUMENT'">
                                            <ng-container *ngFor="let kpiData of submission.documentKpiSubmissions">
                                                <ng-container *ngIf="kpi.id === kpiData.grantKpi.id">
                                                    <div class="col-sm-4 col-lg-6"
                                                         style="border-right: 0.5px solid #d4d4d4;">
                                                        <div class="row">
                                                            <div class="col-sm-6"
                                                                 style="display: flex;align-items: center;">
                                                                <mat-checkbox color="primary"
                                                                              [(ngModel)]="kpiData.toReport"
                                                                              [ngModelOptions]="{standAlone:true}"
                                                                              (ngModelChange)="checkGrant()"></mat-checkbox>
                                                            </div>
                                                            <div class="col-sm-6">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </ng-container>
                                            </ng-container>
                                        </ng-container>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>

                <!--<div class="accordion" id="accordionExample">
                  <ng-container *ngFor="let submission of currentGrant.submissions">
                    <div class="card mb-0">
                      <div class="card-header" id="heading_{{submission.id}}">
                        <div class="row">
                          <div class="col-sm-9">
                            <b class="mb-0 submission-header">

                              <div data-toggle="collapse" [attr.data-target]="'#collapse_'+submission.id">
                                Submission
                                for {{submission.title}} | Submit By: {{submission.submitBy | date}} |
                                Status: {{submission.submissionStatus.displayName}}</div>
                            </b>
                          </div>
                          <div class="col-sm-3 text-right">
                            <button *ngIf="submission.flowAuthorities" class="btn btn-sm btn-primary"
                                    (click)="viewKpisToSubmit(submission.id)">View Submissions
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div id="collapse_{{submission.id}}" class="collapse"
                         [attr.aria-labelledby]="'heading_'+submission.id"
                         data-parent="#accordionExample">
                      <div class="card-body">
                        <div *ngFor="let quantKpi of submission.quantitiaveKpisubmissions">

                          <div class="row border-bottom">
                            <div class="col-sm-8 submission-title"><b>{{quantKpi.grantKpi.title}}</b></div>
                            <div class="col-sm-2 text-center">
                              <circle-progress
                                  [backgroundStrokeWidth]="5"
                                  [percent]="quantKpi.actuals * 100 / quantKpi.goal"
                                  [backgroundPadding]="0"
                                  [radius]="40"
                                  [space]="-1"
                                  [outerStrokeWidth]="10"
                                  [outerStrokeColor]="'#3de033'"
                                  [outerStrokeLinecap]="'square'"
                                  [innerStrokeColor]="'#828282'"
                                  [titleFontSize]="15"
                                  [animateTitle]=false
                                  [title]="[quantKpi.actuals]"
                                  [animationDuration]="100"
                                  [subtitle]="['-&#45;&#45;',quantKpi.goal]"
                                  [showUnits]=false
                              ></circle-progress>
                            </div>
                          </div>
                        </div>
                        <div *ngFor="let qualKpi of submission.qualitativeKpiSubmissions">
                          <div class="row">
                            <div class="col-sm-12"><b>{{qualKpi.grantKpi.title}}</b></div>
                            <div class="col-sm-12 mb-5 border-left">{{qualKpi.actuals}}</div>
                          </div>
                        </div>
                        <div *ngFor="let docKpi of submission.documentKpiSubmissions">
                          <div class="row">
                            <div class="col-sm-12"><b>{{docKpi.grantKpi.title}}</b></div>
                            <div class="col-sm-12 mb-5">
                              <ng-container *ngFor="let doc of docKpi.submissionDocs">
                                <a target="_blank"
                                   href="/api/submission/{{submission.id}}/kpi/{{docKpi.grantKpi.id}}/file/{{doc.id}}">
                                  <p>
                                    <i *ngIf="doc.fileType==='pdf'"
                                       class="fa fa-2x fa-file-pdf-o text-rose"></i>
                                    <i *ngIf="doc.fileType==='jpg'" class="fa fa-2x fa-file-image-o"></i>
                                    <i *ngIf="doc.fileType==='jpeg'" class="fa fa-2x fa-file-image-o"></i>
                                    <i *ngIf="doc.fileType==='png'" class="fa fa-2x fa-file-image-o"></i>
                                    <i *ngIf="doc.fileType==='doc'" class="fa fa-2x fa-file"></i>
                                    {{doc.fileName}}
                                  </p>
                                </a>
                              </ng-container>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                </div>-->
            </div>
        </div>


    </mat-sidenav-content>
</mat-sidenav-container>

<div #editFieldModal class="modal fade" id="editFieldModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <input type="text" id="editFieldIdHolder">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editFieldLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input id="editFieldInput" class="form-control" value="">
            </div>
            <div class="">
                <button type="button" class="btn btn-primary pull-right"
                        (click)="saveField()">Okay
                </button>
                <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>

<div #createFieldModal class="modal fade" id="createFieldModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <input type="text" id="sectionIdHolder">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createFieldLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="fieldTitleInput" class="mat-form-field-label pull-left">Field Name:</label>
                    <input id="fieldTitleInput" class="form-control" value="">
                </div>
                <label for="fieldValueInput" class="mat-form-field-label pull-left">Field Type:</label>
                <select id="fieldValueInput" class="form-control">
                    <option value="string" selected>Text</option>
                    <option value="string">Document</option>
                </select>
            </div>
            <div class="">
                <button type="button" class="btn btn-primary pull-right"
                        (click)="addField()">Okay
                </button>
                <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>

<div #createSectionModal class="modal fade" id="createSectionModal" tabindex="-1" role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createSectionLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="fieldTitleInput" class="mat-form-field-label pull-left">Section Name:</label>
                    <input id="sectionTitleInput" class="form-control" value="">
                </div>
            </div>
            <div class="">
                <button type="button" class="btn btn-primary pull-right"
                        (click)="saveSection()">Done
                </button>
                <button type="button" class="btn btn-warning pull-right"
                        (click)="saveSectionAndAddNew()">Save & Add New Section
                </button>
                <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>


<div #createKpiModal id="createKpiModal" class="modal fade" tabindex="-1"
     role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createReportingPeriodLabel">Add new KPI</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <mat-form-field>
                        <input matInput id="kpiDescription" #kpiDescriptionElem class="form-control"
                               placeholder="KPI description">
                        </mat-form-field>
                    </div>
                    <div class="col-sm-12 text-left">
                        <div id="reporting-data">Select what you want to be reported for this KPI</div>
                        <mat-radio-group class="reporting-data-radio-group" aria-labelledby="reporting-data" (change)="setKpiTypeSection($event)">
                            <mat-radio-button checked class="reporting-data-radio-button" value="Quantitative">Numbers and Metrics</mat-radio-button>
                            <mat-radio-button class="reporting-data-radio-button" value="Qualitative">Long Responses</mat-radio-button>
                            <mat-radio-button class="reporting-data-radio-button" value="Document">Document Attachments</mat-radio-button>
                        </mat-radio-group>
                    </div>
                    <div class="col-sm-12 text-left" *ngIf="currentKPIType==='Quantitative'">
                        <div id="kpi-type">Select the type KPI type</div>
                        <mat-radio-group class="reporting-data-radio-group" aria-labelledby="kpi-type" (change)="setKpiReportingTypeSection($event)">
                            <mat-radio-button class="reporting-data-radio-button"  checked value="activity">Monitoring and Evaluation</mat-radio-button>
                            <mat-radio-button class="reporting-data-radio-button" value="financial">Financial</mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>
            </div>
            <div class="">
                <button type="button" class="btn btn-primary pull-right"
                        (click)="saveKpi()">Done
                </button>
                <!--<button type="button" class="btn btn-warning pull-right"
                        (click)="saveKpiAndAddNew()">Save & Add New KPI
                </button>-->
                <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>


<div #selectScheduleModal id="selectScheduleModal" class="modal fade" tabindex="-1"
     role="dialog"
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createReportingPeriodLabel">Select Grant Schedule</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <mat-select [(ngModel)]="schedule" [ngModelOptions]="{standAlone: true}">
                    <mat-option value="1">Monthly</mat-option>
                    <mat-option value="3">Quarterly</mat-option>
                    <mat-option value="6">Half Yearly</mat-option>
                    <mat-option value="12">Yearly</mat-option>
                </mat-select>
            </div>
            <div class="">
                <button type="button" class="btn btn-primary pull-right"
                        (click)="saveKpi()">Done
                </button>
                <!--<button type="button" class="btn btn-warning pull-right"
                        (click)="saveKpiAndAddNew()">Save & Add New KPI
                </button>-->
                <button type="button" class="btn btn-link pull-right" data-dismiss="modal">Close</button>

            </div>
        </div>
    </div>
</div>



